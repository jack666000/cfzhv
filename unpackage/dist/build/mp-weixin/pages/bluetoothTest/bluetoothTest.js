(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/bluetoothTest/bluetoothTest"],{1343:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){}));var o=function(){var e=this.$createElement;this._self._c},c=[]},"678b":function(e,t,n){"use strict";n.r(t);var o=n("1343"),c=n("e371");for(var i in c)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(i);n("bddd");var a=n("f0c5"),r=Object(a["a"])(c["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=r.exports},"9ea9":function(e,t,n){"use strict";(function(e,t){var o=n("4ea4");n("c530");o(n("66fd"));var c=o(n("678b"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(c.default)}).call(this,n("bc2e")["default"],n("543d")["createPage"])},ac0e:function(e,t,n){"use strict";(function(e){var o=n("4ea4");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var c=o(n("2eee")),i=o(n("448a")),a=o(n("c973")),r=n("3245"),u=n("a6a8"),s={data:function(){return{devices:[],deviceId:"",connectedDeviceId:"",serviceId:"",characteristicId:"",targetDeviceName:"EC:B1:AC:00:95:B4",isConnected:!1}},onLoad:function(){},methods:{startScan:function(){e.showLoading({title:"持续搜索中"}),this.startBluetooth()},sendInstructions:function(){var e=this;return(0,a.default)(c.default.mark((function t(){var n,o,i,a,s,d;return c.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.deviceId,t.next=3,(0,r.getServiceIdAndCharacteristicId)(n);case 3:return o=t.sent,i=o.serviceId,a=o.characteristicId,t.next=8,(0,r.sendDataToDevice)(i,a,n);case 8:s=t.sent,d=s.code,200===d&&(0,u.showModal)("开闸成功");case 11:case"end":return t.stop()}}),t)})))()},startBluetooth:function(){var t=this;e.openBluetoothAdapter({success:function(){t.searchBluetoothDevices()},fail:function(t){e.hideLoading(),console.error("打开蓝牙适配器失败",t),10001===t.errCode?(0,u.showModal)("请开启蓝牙"):1e4===t.errCode?(0,u.showModal)("设备不支持蓝牙"):(0,u.showModal)("打开蓝牙适配器失败")}})},searchBluetoothDevices:function(){var t=this;e.startBluetoothDevicesDiscovery({success:function(){e.hideLoading(),e.onBluetoothDeviceFound((function(e){var n;(n=t.devices).push.apply(n,(0,i.default)(e.devices)),t.autoConnectToDevice()}))},fail:function(t){e.hideLoading(),console.error("搜索蓝牙设备失败",t)}})},autoConnectToDevice:function(){var t=this;if(this.isConnected)console.log("已经连接到设备，不需要再自动连接");else{e.showLoading({title:"连接中"});var n=this.devices.find((function(e){return e.deviceId===t.targetDeviceName}));n&&e.createBLEConnection({deviceId:n.deviceId,success:function(){var o=(0,a.default)(c.default.mark((function o(){return c.default.wrap((function(o){while(1)switch(o.prev=o.next){case 0:return console.log("自动连接设备成功"),e.showToast({title:"成功连接到道闸"}),t.isConnected=!0,t.deviceId=n.deviceId,o.next=6,e.offBluetoothDeviceFound();case 6:return o.next=8,e.stopBluetoothDevicesDiscovery();case 8:case"end":return o.stop()}}),o)})));return function(){return o.apply(this,arguments)}}(),fail:function(t){e.hideLoading(),console.error("道闸连接失败 请联系岗亭人员开闸")}})}}}};t.default=s}).call(this,n("543d")["default"])},bddd:function(e,t,n){"use strict";var o=n("ffc9"),c=n.n(o);c.a},e371:function(e,t,n){"use strict";n.r(t);var o=n("ac0e"),c=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=c.a},ffc9:function(e,t,n){}},[["9ea9","common/runtime","common/vendor"]]]);